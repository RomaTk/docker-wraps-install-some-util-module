# docker-wraps-install-some-util-module
Implements module install some util for docker wraps environment.

This will provide env-scripts for common way to install some utils in the docker wraps environment. `env-scripts/not-by-wrap-name/install-some-util`

## Usage

Add `docker-wraps-install-some-util-module` to as submodule to your project:
```bash
git submodule add https://github.com/RomaTk/docker-wraps-install-some-util-module.git modules/<name-you-like>
```

### Installation process

Installation process consists of mandatory steps:
1. Download the util
2. Install the util

To install some util, you need to have such docker wraps:
- `<util-name>-install`
    - `./dockers/<util-name>/install/configs` folder should be, add there `.gitkeep` file to keep the folder in git.
        - There you can store some files if needed, them will be cleaned by cleaning process (see below).
        - There will be generated file `version.cfg` in this folder, which will contain the version of the util installed. Syntax of the file as example (it is autogenerated by script):
        ```
        VERSION="28.5.0"
        OS="linux"
        ARCH="x86_64"
        ```
    - `./dockers/<util-name>/install/saved-versions` folder should be, add there `.gitkeep` file to keep the folder in git.
        - There will be stored downloaded versions of the util here.
        - This folder will be cleaned by cleaning process (see below), but only files which are not listed in `versions.cfg` file in `download/with-configs/configs` folder. 
- `<util-name>-download-with-configs`
    - `./dockers/<util-name>/download/with-configs/configs` folder should be, add there `.gitkeep` file to keep the folder in git.
        - There you can store some files if needed, them will be cleaned by cleaning process (see below).
        - Within versions.cfg file you can store versions of the util you want to download. Format of the file as example (it is autogenerated by script):
        ```
        VERSIONS=("linux/x86_64/28.4.0" "linux/x86_64/28.5.0")
        ```
- `<util-name>-get-latest-version` (optional)
    - `./dockers/<util-name>/get-latest-version/configs` folder should be, add there `.gitkeep` file to keep the folder in git.
        - There you can store some files if needed, them will be cleaned by cleaning process (see below).

Where `<util-name>` is the name of the util you want to install (e.g. `git-lfs`, `nvm`, `docker`, `git`, `sysbox`, etc).
Docker contexts should be located in the same directory within `docker` folder. 


For each util, you need to create some file like (let's call it `prepare-before-build.sh`):
```bash

#!/bin/bash

function main {
    local version="$1"
    local os="$2"
    local path_to_docker="$3"
    local file_version_in_download_docker_context="$path_to_docker/download/with-configs/configs/versions.cfg"
    local empty_file_name="null-null-null.tar.gz"

    if [ -z "$version" ]; then
        # OPTIONAL: IN CASE IF VERSION IS NOT PROVIDED - will be used the empty file
        source ./env-scripts/not-by-wrap-name/install-some-util/get-latest-version.sh
        [ $? -ne 0 ] && exit 1

        version="$(getLatestVersion "$path_to_docker" "<util-name>")"
        [ $? -ne 0 ] && exit 1
    fi

    source "./env-scripts/not-by-wrap-name/install-some-util/prepare-before-build/main.sh"
    [ $? -ne 0 ] && exit 1

    main "$version" "$os" "<util-name>" "$path_to_docker" "$empty_file_name"
    [ $? -ne 0 ] && exit 1

    exit 0
}

# Depend on util package
function formatArch {
    local arch="$1"

    case "$arch" in
        "x86_64" | "amd64")
            echo "amd64"
            ;;
        "aarch64" | "arm64")
            echo "arm64"
            ;;
        *)
            echo "unsupported"
            exit 1
            ;;
    esac

    exit 0
}

```

This file should be executed by adding to wrap `<util-name>-install` in `build.run.before` section:
```bash
source ./env-scripts/<util-name>/install/prepare-before-build.sh && main "<VERSION(optional)>" "<OS(optional)>" "./dockers/<util-name>"
```

To get version of the util to install, you can use in `build.options` section of the wrap:
```bash
"--build-arg VERSION="$(source ./env-scripts/not-by-wrap-name/install-some-util/read-version.sh && main "./dockers/<util-name>")""
```

```bash
"--build-arg OS="$(source ./env-scripts/not-by-wrap-name/install-some-util/read-os.sh && main "./dockers/<util-name>")""
```

```bash
"--build-arg ARCH="$(source ./env-scripts/not-by-wrap-name/install-some-util/read-arch.sh && main "./dockers/<util-name>")""
```


### Cleaning process

You can clean all created wrap data by adding to wrap:
- `<util-name>-install` in `clean` section:
```bash
source ./env-scripts/not-by-wrap-name/install-some-util/clean.sh && main "./dockers/<util-name>" "install"
```
- `<util-name>-download-with-configs` in `clean` section:
```bash
source ./env-scripts/not-by-wrap-name/install-some-util/clean.sh && main "./dockers/<util-name>" "download"
```
- `<util-name>-get-latest-version` in `clean` section:
```bash
source ./env-scripts/not-by-wrap-name/install-some-util/clean.sh && main "./dockers/<util-name>" "get-latest-version"
```